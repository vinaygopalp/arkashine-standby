
crops = {
    "rice_or_paddy": {
        "frequency": "Quarterly",
        "npk": ["100:60:60"],
        "target_yield": ["18-19 Quintals per acre"],
    },
    "wheat": {
        "frequency": "Annual",
        "npk": ["40:30:20"],
        "target_yield": ["10 to 15 Quintals per acre"],
    },
    # "jowar": {
    #     "frequency": "Annual",
    #     "npk": [],
    #     "target_yield": [""],
    # },
    # "bajra": {
    #     "frequency": "Annual",
    #     "npk": [],
    #     "target_yield": [""],
    # },
    "ginger": {
        "frequency": "Annual",
        "npk": ["40:20:20"],
        "target_yield": ["15-20 tons per acre h"],
    },
    "tomato_hybrid": {
        "frequency": "Annual",
        "npk": ["100:100:100"],
        # "npk": "hybrid- 100:100:100",
        "target_yield": ["24 - 30 tons per acre hybrid"],
    },
    "tomato_improved_varieties": {
        "frequency": "Annual",
        "npk": ["46:40:24"],
        "target_yield": ["10-12 tons per acre"],
    },
    "garlic": {
        "frequency": "Annual",
        "npk": ["50:25:25"],
        "target_yield": ["3.2 tons per acre"],
    },
    "urad": {
        "frequency": "Annual",
        "npk": ["10:20:10"],
        "target_yield": ["4-7 Quintals per acre"],
    },
    "chilli": {
        "npk": ["60:30:30"],
        "target_yield": ["Green chilli- 14 to 16 ton per acre", "Red Chilli- 1.4 to 1.6 ton per acre"],
        "frequency": "Half"
    },
    "cotton": {
        "npk": ["60:30:30"],
        "target_yield": ["Black Soil- 7 to 8 Quintals per acre", "Sandy Soil- 5 to 6 Quintls per acre"],
        "frequency": "Annual"
    },
    "chana": {
        "npk": ["10:20:20"],
        "target_yield": ["6 to 8 Quintals per acre"],
        "frequency": "Quartely"
    },
    "sunflower": {
        "npk": ["36:36:25"],
        "target_yield": ["8 to 10 Quintasl per acre"],
        "frequency": "Annual"
    },
    "onion": {
        "npk": ["15:30:50"],
        "target_yield": ["8 to 10 tonns per acre"],
        "frequency": "Annual"
    },
    "moong": {
        "npk": ["10:20:20"],
        "target_yield": ["4 to 5 Quintals/acre"],
        "frequency": "Annual"
    },
    "masoori": {
        "npk": ["10:20:10"],
        "target_yield": ["5 to 6 Quintal/acre"],
        "frequency": "Annual"
    },
    "ragi": {
        "npk": ["40:20:20"],
        "target_yield": ["12 to 18 Quintals per acre"],
        "frequency": "Annual"
    },
    "sugarcane": {
        "npk": ["100:40:50"],
        "target_yield": ["60 to 70 tonns per acre"],
        "frequency": "Annual"
    },
    "arabica_coffee": {
        "npk": ["15:24:12", "20:30:15", "30:47:23", "56:36:56", "64:48:64"],
        "duration": ["1st year", "2nd year", "3rd year", "4th year", "5th year"],
        # "npk": "1st year-15:24:12\n2nd year-20:30:15\n3rd year-30:47:23\n4th year- 56:36:56\n5th year-64:48:64",
        "target_yield": ["800 tonns per acre"],
        "frequency": "Annual"
    },
    "maize_dry_land": {
        "npk": ["40:30:16"],
        "duration": ["Dry land"],
        # "npk": "Dry land-40:30:16\nIrrigated 60:30:15",
        "target_yield": ["32- 35 tonns per acre"],
        "frequency": "Annual"
    },
    "maize_irrigated": {
        "npk": ["60:30:15"],
        "duration": ["Irrigated"],
        # "npk": "Dry land-40:30:16\nIrrigated 60:30:15",
        "target_yield": ["30-33 tonns per acre"],
        "frequency": "Annual"
    },
    "groundnut": {
        "npk": ["10:30:15"],
        "target_yield": ["8 to 10 tonns per acre"],
        "frequency": "Annual"
    },
    "sesame": {
        "npk": ["15:10:10"],
        "target_yield": ["1.6 to 2 tonns per acre"],
        "frequency": "Annual"
    },
    "arecanut": {
        "npk": ["100:40:140"],
        "target_yield": ["500 to 600 kg per acre"],
        "frequency": "Annual"
    },
    "rubber": {
        "npk": ["25:25:10", "90:90:40", "110:110:50", "90:90:40", "140: 90:60"],
        "duration": ["1st year gm per tree", "2nd year gm per tree", "3rd year gm per tree", "4th year gm per tree", "5th year"],
        # "npk": "1st year-25:25:10 gm per tree, 2nd year- 90:90:40 gm per tree, 3rd year- 110:110:50 gm per tree, 4th year- 90:90:40 gm per tree, 5th year- 140: 90:60",
        "target_yield": ["300-400 kg/acre"],
        "frequency": "Annual"
    },
    "banana_pache_variety": {
        "npk": ["260:130:270"],
        "duration": ["pache variety"],
        # "npk": "pache variety- 260:130:270, kandu variety- 175:105:220, other varieties- 160:96:200",
        "target_yield": ["8-12 tonns per acre for pache variety"],
        "frequency": "Annual"
    },
    "banana_kandu_variety": {
        "npk":["175:105:220"],
        "duration": ["kandu variety"],
        # "npk": "pache variety- 260:130:270, kandu variety- 175:105:220, other varieties- 160:96:200",
        "target_yield": ["12-14 tonns per acre for kandu variety"],
        "frequency": "Annual"
    },
    "banana_other_varieties": {
        "npk": ["160:96:200"],
        "duration": ["other varieties"],
        # "npk": "pache variety- 260:130:270, kandu variety- 175:105:220, other varieties- 160:96:200",
        "target_yield": ["12-16 tonns per acre for other varieties"],
        "frequency": "Annual"
    },
    "cow_pea_or_aldisandi": {
        "npk": ["10:20:10"],
        "target_yield": ["5 to 6 Quintals per acre"],
        "frequency": "Annual"
    },
    "kusume_or_safflower": {
        "npk":["16:16:05"],
        "target_yield": ["4 to 5 Quintals per acre"],
        "frequency": "Annual"
    },
    "soyabean": {
        "npk": ["12:32:15"],
        "target_yield": ["10-12 Quintals per acre"],
        "frequency": "Annual"
    },
    "castor": {
        "npk": ["15:15:10"],
        "target_yield": ["Hybrids-5 to 7 Quintals per acre", "Improved varities-4 to 5 Quintal per acre"],
        "frequency": "Annual"
    },
    "coriander": {
        "npk": ["14:14:14"],
        "target_yield": ["Seed- 200 to 300 Kg per acre", "plant- 3.4 to 4 tonns per acre"],
        "frequency": "Annual"
    },
    "turmeric": {
        "npk": ["60:50:100"],
        "target_yield":[ "8 to 10 tonns per acre"],
        "frequency": "Annual"
    }
}


def calculate_fertilizer_doses(npk_recommended, kg):
    print(npk_recommended)
    # Assume the npk_recommended value is in the format of "120:60:60"
    n, p, k = map(float, npk_recommended.split(":"))

    mop_dose = (kg/60) * k
    # mop_dose = k / 0.6

    dap_dose = (kg/46) * p
    # dap_dose = p / 0.46

    urea_dose = (100/46) * (n-((18/100) * dap_dose))
    # ans = 180/100 * dap_dose
    # ans2 = n - ans
    # urea_dose = 100/46 * ans2

    # Calculate the SSP doses

    urea_dose = 0 if ( urea_dose < 0) else urea_dose

    ssp_dose = (p/16) * kg


    return round(mop_dose, 2), convert_to_acre(mop_dose), round(dap_dose, 2), convert_to_acre(dap_dose), round(urea_dose, 2), convert_to_acre(urea_dose), round(ssp_dose, 2), convert_to_acre(ssp_dose),


def convert_to_acre(hectre_value):
    return round(hectre_value/2.5, 2)

def convert_to_hector(acre_value):
    return round(acre_value*2.5, 2)

def calc_soil_parameters(pH, EC, OC):
    if pH < 6.5 and EC < 4:
        remedy = "Apply lime"
    elif pH > 7.7 and 8.5 > EC:
        remedy = "Remove salts with leaching and drainage"
    elif pH > 8.5 and EC < 4:
        remedy = "Gypsum application required"
    else:
        remedy = "No remedy needed"

    if OC < 0.5:
        fertility = "Low fertile, recommend green manure"
    elif 0.5 <= OC < 0.75:
        fertility = "Medium fertile, soil is fertile"
    else:
        fertility = "High fertile, soil is fertile"

    return remedy, fertility


def calc_fymanure(frequency):
    if frequency == "Annual":
        fym = convert_to_hector(4)
    else:
        fym = convert_to_hector(10)

    return fym

# crop_type = "Annual crops" # form API

# npk_recommended = "30:60:30" # from API
# kg = 100

# mop_dose, mop_in_hec, dap_dose, dap_in_hec, urea_dose, urea_in_hec, ssp_dose, ssp_in_hec = calculate_fertilizer_doses(
#     npk_recommended, kg)

# # from API
# pH = 7.2
# EC = 3.8
# OC = 0.6

# remedy, fertility = calc_soil_parameters(pH, EC, OC)
# fym               = calc_fymanure(crop_type)

# print("The recommended doses of fertilizer are:")
# print("Urea:", urea_dose, "kg/hectare", urea_in_hec, "kg/acre")
# print("DAP:", dap_dose, "kg/hectare", dap_in_hec, "kg/acre")
# print("MOP:", mop_dose, "kg/hectare", mop_in_hec, "kg/acre")
# print("SSP:", ssp_dose, "kg/hectare", ssp_in_hec, "kg/acre")


# print(f"Soil remedy: {remedy}")
# print(f"Soil fertility: {fertility}")
# print(f"FYM: {fym} tons/hectare")
# print("Crop target yeild given in object : target yield from the dict for given crop in API")



# if all npk values are given properly then conditions
def get_n_value(n_input, n_dict):
    n_dict = float(n_dict)
    if n_input < 280:
        return n_dict + ((25/100) * n_dict)
    if n_input >= 280 and n_input <= 560:
        return n_dict
    if n_input > 560 :
        return n_dict - ((25/100) * n_dict)

def get_p_value(p_input, p_dict):
    p_dict = float(p_dict)
    if p_input < 22:
        return p_dict + ( (25/100) * p_dict)
    if p_input >= 22 and p_input <= 56:
        return p_dict
    if p_input > 56 :
        return p_dict - ( (25/100) * p_dict)

def get_k_value(k_input, k_dict):
    k_dict = float(k_dict)
    if k_input < 141:
        return k_dict + ( (25/100) * k_dict)
    if k_input >= 141 and k_input <= 336:
        return k_dict
    if k_input > 336 :
        return k_dict - ( (25/100) * k_dict)

def npk_is_valid(n,p,k):
    if (n > 1000 or n < 1) and (p > 1000 or p < 1) and (k > 1000 or k < 1):
        return False
    else:
        return True 
        
def get_crop_urea_dap_mop_dose(n, p, k, ph, ec, oc, crop):
    return_data_1 = []
    return_data_2 = []
    remedy        = ''
    fertility     = ''
    n_p_k         = []
    if crop in crops: # check if crop`` is valid
        dict_crop = crops[crop]
        crop_n_p_ks = dict_crop['npk']
        if not npk_is_valid(n,p,k): # if any one of the parms are not present the fetch values from the crops table
                for values in crop_n_p_ks:
                    v = values.split(':')
                    n_p_k.append(f"{v[0]}:{v[1]}:{v[2]}")
        else:
            for values in crop_n_p_ks:
                v = values.split(':')
                n_p_k.append(f"{get_n_value(n, v[0])}:{get_p_value(p, v[1])}:{get_k_value(k, v[2])}")
    else:
        return "send valid crop"
    kg = 100
    for index, vals in enumerate(n_p_k):
        mop_dose, mop_in_hec, dap_dose, dap_in_hec, urea_dose, urea_in_hec, ssp_dose, ssp_in_hec = calculate_fertilizer_doses(
        vals, kg)

        if 'duration' in dict_crop:
            duration = dict_crop['duration'][index]
            return_data_1.append([
                # "The recommended doses of fertilizer are:",
                f"For {duration}",
                f"Urea : {urea_dose} kg/acre {urea_in_hec} kg/hectare",
                f"DAP : {dap_dose} kg/acre {dap_in_hec} kg/hectare",
                f"MOP : {mop_dose} kg/acre {mop_in_hec} kg/hectare",
                f"SSP : {ssp_dose} kg/acre {ssp_in_hec} kg/hectare",
            ])
        else :
            return_data_1.append([
                # "The recommended doses of fertilizer are:",
                f"Urea : {urea_dose} kg/acre {urea_in_hec} kg/hectare ",
                f"DAP : {dap_dose} kg/acre {dap_in_hec} kg/hectare ",
                f"MOP : {mop_dose} kg/acre {mop_in_hec} kg/hectare ",
                f"SSP : {ssp_dose} kg/acre {ssp_in_hec} kg/hectare ",
            ])
    if (ph and ec and oc):
        remedy, fertility = calc_soil_parameters(ph, ec, oc)
        
    fym = calc_fymanure(dict_crop['frequency'])

    for target_yield in dict_crop['target_yield']:
        if (ph and ec and oc):
            return_data_2.append([
                f"Soil remedy: {remedy}",
                f"Soil fertility: {fertility}",
                f"FYM: {fym} tons/hectare",
                f"Crop target yeild : {target_yield}"
            ])
        else :
            return_data_2.append([
                f"FYM: {fym} tons/hectare",
                f"Crop target yeild : {target_yield}"
            ])

    return {'crop_fertilizer' : return_data_1, 'fym' : return_data_2}

# npk validations should not be less than 999 or -ve

def get_crop_list(api = False):
    sorted_crops = sorted(crops)
    return ((crop, crop) if not api else crop for crop in sorted_crops)